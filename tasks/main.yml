---
- name: Install MySQL
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - mysql-client
    - mysql-server
    - libmysqlclient-dev
    - python-mysqldb

- name: Set conf directory
  set_fact:
    mysql_extra_conf_dir: /etc/mysql/conf.d
  when: ansible_distribution_version < '16.04'

- name: Set conf directory
  set_fact:
    mysql_extra_conf_dir: /etc/mysql/mysql.conf.d
  when: ansible_distribution_version >= '16.04'

- name: Remove root user
  mysql_user:
    name: root
    state: absent
    config_file: /etc/mysql/debian.cnf

- name: Apply local conf settings
  copy:
    src: local.cnf
    dest: "{{ mysql_extra_conf_dir }}/local.cnf"
  notify: restart mysql
